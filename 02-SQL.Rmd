Introducción al lenguaje SQL
============================

Los sistemas de información gestionan repositorios de información en múltiples formatos, 
siendo el más popular las bases de datos relacionales a las que se accede mediante SQL (Structured 
Query Language)

## Bases de Datos Relacionales

### Definiciones

* Dominio: contexto (organización, empresa, evento...) objeto de gestión de la información.

* Dato: hecho con significado implícito, registable, relevante en un determinado dominio.

* Base de datos: colección de datos de un determinado dominio relacionados entre sí, organizados de forma que sea posible manipularlos y recuperarlos de forma eficiente.

* Sistema de Gestión de Bases de Datos (SGBD): software que permite a los usuarios crear y manipular bases de datos mediante operaciones CRUD:
 +Crear / Insertar Datos (Create)
 +Consultar / Leer (Read)
 +Actualizar / Modificar (Update)
 +Eliminar (Delete)

* Modelo de datos: abstracción conceptual que propone una manera de organizar y manipular los datos. Definido mediante:
 +Estructura: elementos para organizar datos
 +Integridad: reglas para relaciones los elementos
 +Manipulación: operaciones sobre los datos adaptadas a la estructura y reglas

* Modelo de datos conceptual Entidad Relación (entidades, relaciones, atributos)

* Modelo de datos lógico o de representación (modelo relacional de Codd)

* Modelo de datos físico (tal y como se almacenan los datos)

* Modelo Relacional
 +Datos en relaciones (tablas)
 +Base matemática formal
 +Flexible

Una fila de la tabla (relación) es una tupla y una columna un atributo. 

![](images/Relacion.png)

Una base de datos es un conjunto de tablas (al menos una).

![](images/BBDD.png)

La tabla no es una relación porque la relación es un conjunto sin orden y una tabla puede tener filas repetidas y tiene orden.


* Restricción de dominio: el valor de cada atributo debe de ser único, no descomponible (nombre completo descomponible en nombre y apellidos, Domicilio 


## Sintaxis SQL



## Conexión con bases de datos desde R 

### Introducción a SQL en R

SQL (Structured Query Language) ... 

Paquetes:

- [DBI] (https://cran.r-project.org/web/packages/DBI/index.html)
- RODBC
- dbConnect
- RSQLite
- RMySQL
- RPostgreSQL

aunque el básico sqldf 

```{r,error=FALSE,message=FALSE,warning=FALSE}
library(sqldf)
```

```{r}
sqldf('SELECT age, circumference FROM Orange WHERE Tree = 1 ORDER BY circumference ASC')
```

### SQL Queries

El comando inicial es SELECT. SQL no es case-sensitive, por lo que esto va a funcionar:

```{r,eval=FALSE}
sqldf("SELECT * FROM iris")
sqldf("select * from iris")
```

pero lo siguiente no va a funcionar (a menos que tengamos un objeto IRIS:

```{r,eval=FALSE}
sqldf("SELECT * FROM IRIS")
```

La sintaxis básica de SELECT es:

```{r,eval=FALSE}
SELECT variable1, variable2 FROM data
```

#### Asterisco/Wildcard

Lo extrae todo

```{r}
bod2 <- sqldf('SELECT * FROM BOD')
```

#### Limit

Limita el número de resultados

```{r}
sqldf('SELECT * FROM iris LIMIT 5')
```

#### Order By

Ordena las variables

```{r,eval=FALSE}
ORDER BY var1 {ASC/DESC}, var2 {ASC/DESC}
```

```{r}
sqldf("SELECT * FROM Orange ORDER BY age ASC, circumference DESC LIMIT 5")
```

#### Where

Sentencias condicionales, donde se puede incorporar operadores lógicos AND y OR, expresando el orden de evaluación con paréntesis en caso de ser necesario.

```{r}
sqldf('SELECT demand FROM BOD WHERE Time < 3')
```

```{r}
sqldf('SELECT * FROM rock WHERE (peri > 5000 AND shape < .05) OR perm > 1000')
```

Y extendiendo su uso con IN o LIKE (es último sólo con %), pudiendo aplicárseles el NOT:

```{r}
sqldf('SELECT * FROM BOD WHERE Time IN (1,7)')
```

```{r}
sqldf('SELECT * FROM BOD WHERE Time NOT IN (1,7)')
```

```{r}
sqldf('SELECT * FROM chickwts WHERE feed LIKE "%bean" LIMIT 5')
```

```{r}
sqldf('SELECT * FROM chickwts WHERE feed NOT LIKE "%bean" LIMIT 5')
```



















